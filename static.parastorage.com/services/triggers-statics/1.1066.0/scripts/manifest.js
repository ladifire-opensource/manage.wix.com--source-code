"use strict";var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),__assign=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a},__awaiter=this&&this.__awaiter||function(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b||[])).next())})},__generator=this&&this.__generator||function(a,b){function c(a){return function(b){return d([a,b])}}function d(c){if(e)throw new TypeError("Generator is already executing.");for(;i;)try{if(e=1,f&&(g=2&c[0]?f.return:c[0]?f.throw||((g=f.return)&&g.call(f),0):f.next)&&!(g=g.call(f,c[1])).done)return g;switch(f=0,g&&(c=[2&c[0],g.value]),c[0]){case 0:case 1:g=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,f=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(g=i.trys,!(g=g.length>0&&g[g.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!g||c[1]>g[0]&&c[1]<g[3])){i.label=c[1];break}if(6===c[0]&&i.label<g[1]){i.label=g[1],g=c;break}if(g&&i.label<g[2]){i.label=g[2],i.ops.push(c);break}g[2]&&i.ops.pop(),i.trys.pop();continue}c=b.call(a,i)}catch(a){c=[6,a],f=0}finally{e=g=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}var e,f,g,h,i={label:0,sent:function(){if(1&g[0])throw g[1];return g[1]},trys:[],ops:[]};return h={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h},__rest=this&&this.__rest||function(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&b.indexOf(d)<0&&(c[d]=a[d]);if(null!=a&&"function"==typeof Object.getOwnPropertySymbols)for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++)b.indexOf(d[e])<0&&(c[d[e]]=a[d[e]]);return c},triggers;!function(a){var b=this,c=BusinessManagerAPI.ModuleId,d=BusinessManagerAPI.registerModule,e=function(a){return"true"===a["specs.crm.TriggersAddArtifactIdHeaderForForms"]?{"X-Wix-Client-Artifact-Id":"triggers-statics"}:{}},f=function(a,b){return{headers:__assign({Authorization:a},e(b))}},g=function(a){return{headers:{"X-Wix-Instance":a}}},h=axios.create(),i=function(a){function b(c){return a.call(this,c,{files:b.getFiles(c),module:"triggersApp",component:"triggers-bzm-app",prepare:function(){return b.prepare(c)}})||this}return __extends(b,a),b.prepare=function(a){var b=a.config.topology,c=a.instance;return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(d){switch(d.label){case 0:return[4,ModuleRegistry.invoke("automations.getExperiments")];case 1:return a=d.sent(),angular.module("triggersApp").config(["experimentManagerProvider",function(b){b.setExperiments(a)}]).constant("clientTopology",b).config(["$provide","$locationProvider","wixAngularTopologyProvider",function(a,b,d){d.setInstance(c),b.html5Mode(!0),a.decorator("$browser",["$delegate",function(a){return a.baseHref=function(){return location.pathname.substring(0,location.pathname.indexOf("triggers"))},a}])}]),[2]}})})},b.getFiles=function(a){var b=a.config.topology.triggersStaticsUrl,c=a.accountLanguage,d=a.debug,e=d?"concat/":"";return[[""+b+e+"scripts/bzm-modules.js",""+b+e+"scripts/scripts.js"],b+"scripts/locale/bzm-messages_"+c+".js",b+"bower_components/angular-material/angular-material.css",b+"bower_components/dashboard-ui-components/dist/styles/dashboard-ui-components-base.css",b+"bower_components/dashboard-ui-components/dist/styles/dashboard-ui-components.css",b+"styles/main.css"]},b}(AngularLazyComponent),j=function(a){function b(c){return a.call(this,c,{files:b.getFiles(),component:"send-mail-component"})||this}return __extends(b,a),b.getFiles=function(){var a=ModuleRegistry.getModule("TRIGGERS").moduleParams,b=a.config.topology.sendMailStaticsUrl,c=a.debug,d=c?"":".min";return[b+"send-mail-component.bundle"+d+".js",b+"app"+d+".css"]},b}(ReactLazyComponent),k=function(a){function b(c){return a.call(this,c,{files:b.getFiles(),component:"zapier-action-component",resolve:function(){return Promise.resolve(__assign({},b.moduleParams()))}})||this}return __extends(b,a),b.moduleParams=function(){return ModuleRegistry.getModule("TRIGGERS").moduleParams},b.getFiles=function(){var a=this.moduleParams(),b=a.config.topology.zapierActionStaticsUrl,c=a.debug,d=c?"":".min";return[b+"zapier-action-component.bundle"+d+".js",b+"zapier-action-component"+d+".css"]},b}(ReactLazyComponent),l=function(a){function b(c){return a.call(this,c,{files:b.getFiles(c),component:"smart-actions-module",resolve:function(){return ModuleRegistry.getModule("TRIGGERS").activitiesMigration}})||this}return __extends(b,a),b.getFiles=function(a){var b=a.config.topology.smartActionsStaticsUrl,c=a.debug,d=c?"":".min";return[b+"smart-actions-module.bundle"+d+".js",b+"smart-actions-module"+d+".css"]},b.prefetch=function(a){return b.getFiles(a)},b}(ReactLazyComponent),m=function(a){return __awaiter(b,void 0,void 0,function(){var b,c;return __generator(this,function(d){return b=ModuleRegistry.invoke("businessManager.isAppInstalled",a),b?(c=ModuleRegistry.invoke("businessManager.getCurrentInstance",a),[2,c||Promise.reject()]):[2,Promise.reject()]})})},n=function(a){return function(b){var c=b.data.forms;return c.length>0?{"form-id":{displayName:a["event.forms.formName"],displayInfo:a["event.forms.formInfo"],optionalConditionHeader:a["event_select.trigger_select.select_form"],useConditionOptionText:a["wizard.condition_select.select_specific_form"],dontUseConditionOptionText:a["wizard.condition_select.select_any_form"],options:function(){return Promise.resolve(c.reduce(function(a,b){var c,d=b.formId,e=b.formName;return __assign({},a,(c={},c[d]=e,c))},{}))}}}:{}}},o=function(a){return function(b){return b.data.forms.filter(function(b){var c=b.formId;return a["form-id"]&&a["form-id"].toJSON().includes(c)}).reduce(function(a,b){var c=b.fields,d=b.formName;return a.concat(c.map(function(a){return __assign({},a,{formName:d})}))},[]).reduce(function(a,b){var c,d=b.formName,e=b.fieldId,f=b.fieldName;return __assign({},a,(c={},c["field:"+e]={displayName:f+" ["+d+"]",type:"string"},c))},{})}},p=function(a,b,c,d){return m(a).then(function(a){return h.get("/_api/wix-form-builder-web/v1/forms?paging.limit=1000&filter.status=PUBLISHED",f(b+a,d)).then(c)}).catch(function(){return{}})},q=function(a){var b=a.translations,c=a.contactFields;return Object.keys(c).reduce(function(a,d){var e;return __assign({},a,(e={},e[d]=__assign({},c[d],{displayName:b[c[d].displayName]}),e))},{})},r={"contact.Name.First":{displayName:"contactSchema.firstName",type:"string"},"contact.Name.Middle":{displayName:"contactSchema.middleName",type:"string"},"contact.Name.Last":{displayName:"contactSchema.lastName",type:"string"},"contact.Email[0]":{displayName:"contactSchema.firstEmail",type:"string"},"contact.Email[1]":{displayName:"contactSchema.secondEmail",type:"string"},"contact.Email[2]":{displayName:"contactSchema.thirdEmail",type:"string"},"contact.Phone[0]":{displayName:"contactSchema.firstPhone",type:"string"},"contact.Phone[1]":{displayName:"contactSchema.secondPhone",type:"string"},"contact.Phone[2]":{displayName:"contactSchema.thirdPhone",type:"string"},"contact.Address[0].Country":{displayName:"contactSchema.country",type:"string"},"contact.Address[0].Street":{displayName:"contactSchema.street",type:"string"},"contact.Address[0].City":{displayName:"contactSchema.city",type:"string"},"contact.Address[0].Zip":{displayName:"contactSchema.zip",type:"string"}},s=function(){function a(){}return a.fetchActivitiesFor=function(a,b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(d){switch(d.label){case 0:return[4,h.get(""+this.apiUrl+b+"/activities",g(a))];case 1:return c=d.sent(),[2,c.data&&c.data.data]}})})},a.getActivityEvents=function(a){var b=a.instance,c=a.instanceId,d=a.baseUrl,e=a.locale,f=a.experiments;return __awaiter(this,void 0,void 0,function(){var a,g,i,j,k,l=this;return __generator(this,function(m){switch(m.label){case 0:return[4,h.get(d+"assets/locale/messages_"+e+".json")];case 1:return a=m.sent().data,g=q({translations:a,contactFields:r}),[4,this.fetchActivitiesFor(b,c)];case 2:return i=m.sent()||[],i.push("form/form/code"),i.push("form/form"),[4,this.activityEvents({translations:a,experiments:f})];case 3:return j=m.sent(),k=i.map(function(a){return l.activityToEvents(a,j)}).reduce(function(a,b){return a.concat(b)},[]).filter(function(a){var b=a.displayName,c=a.appDefId;return b&&c}).sort(this.byDisplayOrder).reduce(function(b,c){var d,e=c.eventId,h=c.appDefId,i=c.appTitle,j=c.displayName,k=c.displayDescription,l=c.displayColor,m=c.activityType,n=c.conditions,q=c.providesContactInfo,r=c.supportsImmediateChat,s=c.supportsPingNotification,t=c.actionComponentInfo,u=b[h]||{events:{}};return b[h]={appTitle:a[i],events:__assign({},u.events,(d={},d[e]={displayName:"grouped."+j,displayDescription:k,displayColor:l,removeSourceUniqueId:"form/form/code"!==e,supportsImmediateChat:r,activityType:m,conditions:n,providesContactInfo:q,supportsPingNotification:s,actionComponentInfo:t},d)),generateEventSchema:function(a,b){switch(a){case"form/form":return p(BusinessManagerAPI.appDefIds.wixForms,"",o(b),f).then(function(a){return __assign({},a,g)});case"form/form/code":return p(h,"wixcode-dev.",o(b),f);default:return Promise.resolve(g)}}},b},{}),[2,k]}})})},a.activityEvents=function(a){var c=a.translations,d=a.experiments;return __awaiter(b,void 0,void 0,function(){var a,b,e,f,g,h,i,j;return __generator(this,function(k){switch(k.label){case 0:return[4,Promise.all([p(BusinessManagerAPI.appDefIds.wixForms,"",n(c),d),p(BusinessManagerAPI.appDefIds.wixCode,"wixcode-dev.",n(c),d)])];case 1:return a=k.sent(),b=a[0],e=a[1],f=!ModuleRegistry.getModule("TRIGGERS").moduleParams.liveSite,g=0!==Object.keys(b).length,h=0!==Object.keys(e).length,i="true"!==d["specs.crm.AutomationsHideContactForm"],j="true"===d["specs.crm.AutomationsEcomPurchaseRelocation"],[2,__assign({},f?{}:{"form/form":[{appDefId:BusinessManagerAPI.appDefIds.wixForms,appTitle:"appTitle.forms",displayName:"event.forms",displayDescription:"event.description.forms",displayColor:"#17B0E2",displayOrder:0,conditions:g?b:void 0,actionComponentInfo:{actionConfig:{templateTag:"code_thank_you_email"}}}]},h?{"form/form/code":[{appDefId:BusinessManagerAPI.appDefIds.wixCode,appTitle:"appTitle.wixCodeForms",eventId:"form/form/code",displayName:"event.code",displayDescription:"event.description.code",displayColor:"#FF8D41",displayOrder:-1,providesContactInfo:!1,supportsPingNotification:!0,conditions:e}]}:{},i&&!f?{"contact/contact-form":[{appDefId:BusinessManagerAPI.appDefIds.wixContactForm,appTitle:"appTitle.contactForm",displayName:"event.contact_form",displayDescription:"event.description.contact_form",displayColor:"#C53E99",displayOrder:1}]}:{},j?{}:{"e_commerce/purchase":[{appDefId:BusinessManagerAPI.appDefIds.wixECommerce,appTitle:"appTitle.stores",displayName:"event.ecom_purchase",displayDescription:"event.description.ecom_purchase",displayColor:"#3370FB",displayOrder:2}]},{"contact/subscription-form":[{appDefId:BusinessManagerAPI.appDefIds.getSubscribers,appTitle:"appTitle.getSubscribers",displayName:"event.contact_subscribe",displayDescription:"event.description.contact_subscribe",displayColor:"#3D9FA1",displayOrder:3}],"hotels/purchase":[{appDefId:BusinessManagerAPI.appDefIds.hotels,appTitle:"appTitle.hotels",displayName:"event.hotel_purchase",displayDescription:"event.description.hotel_purchase",displayColor:"#4ABD81",displayOrder:4,supportsImmediateChat:!1}]},f?{}:{"auth/login":[{appDefId:BusinessManagerAPI.appDefIds.wixSiteMembers,appTitle:"appTitle.members",displayName:"event.member_login",displayDescription:"event.description.member_login",displayColor:"#FDB10C",displayOrder:5}]},f?{}:{"auth/register":[{appDefId:BusinessManagerAPI.appDefIds.wixSiteMembers,appTitle:"appTitle.members",displayName:"event.member_register",displayDescription:"event.description.member_register",displayColor:"#FDB10C",displayOrder:6,conditions:{status:{displayName:"Status",isPredefined:!0,options:function(){return Promise.resolve(["APPLICANT","ACTIVE"])}}}}]},f?{}:{"auth/status-change":[{appDefId:BusinessManagerAPI.appDefIds.wixSiteMembers,appTitle:"appTitle.members",displayName:"event.member_status_change.approved",displayDescription:"event.description.member_status_change.approved",displayColor:"#FDB10C",displayOrder:8,supportsImmediateChat:!1,conditions:{status:{displayName:"New Status",isPredefined:!0,options:function(){return Promise.resolve(["ACTIVE"])}}}}]})]}})})},a.activityToEvents=function(a,b){return(b[a]||[]).map(function(b){return __assign({activityType:a,eventId:a},b)})},a.byDisplayOrder=function(a,b){return a.displayOrder-b.displayOrder},a.apiUrl="/_api/action-triggers-server/v1/",a}(),t=function(a){function b(b){var c=a.call(this,b)||this;return c.eventRegistry={},c.actionRegistry={},c.eventRegistryV2=[],c.actionRegistryV2=[],c.translationsCache=new Map,c.appDefId="139ef4fa-c108-8f9a-c7be-d5f492a2c939",c.activitiesMigration=new Promise(function(a){return c.activitiesMigrationResolver=a}),ModuleRegistry.registerComponent("triggers",function(){return i}),ModuleRegistry.registerComponent("send-mail-lazy-component",function(){return j}),ModuleRegistry.registerComponent("zapier-action-lazy-component",function(){return k}),ModuleRegistry.registerComponent("smart-actions",function(){return l}),c}return __extends(b,a),b.prototype.init=function(a){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return this.moduleParams=a,b=this,[4,ModuleRegistry.invoke("automations.getExperiments")];case 1:return b.experiments=c.sent(),this.activitiesMigrationResolver(),this.registerSendMail(a),this.registerZapierAction(a),this.registerInvoiceEvents(a),this.registerPriceQuoteEvents(a),[2]}})})},b.prototype.migrateActivities=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,d,e,f,g;return __generator(this,function(h){switch(h.label){case 0:return b=this.moduleParams,c=b.instanceId,d=b.accountLanguage,e=b.config.topology.smartActionsStaticsUrl,f=BusinessManagerAPI.getCurrentInstance(BusinessManagerAPI.appDefIds.triggers),[4,s.getActivityEvents({instance:f,instanceId:c,locale:d,baseUrl:e,experiments:a})];case 1:return g=h.sent(),this.eventRegistry=Object.keys(g).reduce(function(a,b){var c=a[b]||{events:{}},d=g[b];return a[b]={appTitle:d.appTitle,events:__assign({},d.events,c.events),generateEventSchema:c.generateEventSchema||d.generateEventSchema},a},this.eventRegistry||{}),[2]}})})},b.prototype.registerPriceQuoteEvents=function(a){var b=a.accountLanguage,c=a.config.topology.smartActionsStaticsUrl;return __awaiter(this,void 0,void 0,function(){var a,d,e,f=this;return __generator(this,function(g){switch(g.label){case 0:return[4,h.get(c+"assets/locale/messages_"+b+".json")];case 1:return a=g.sent().data,d=["send","accept","future/expire"].reduce(function(a,b){var c;return __assign((c={},c["price-quote/"+b]={displayName:"grouped.event.price_quote_"+b,displayDescription:"event.description.price_quote_"+b,displayColor:"#ED6779",removeSourceUniqueId:"send"===b||"accept"===b,supportsImmediateChat:!1,supportsPreEventTrigger:"future/expire"===b},c),a)},{}),e={appDefId:BusinessManagerAPI.appDefIds.priceQuotes,appTitle:a["appTitle.priceQuotes"],events:d,generateEventSchema:function(b,c){return __awaiter(f,void 0,void 0,function(){return __generator(this,function(b){return[2,__assign({},q({translations:a,contactFields:r}),{"price-quote-title":{displayName:a["priceQuoteSchema.priceQuoteTitle"],type:"text"},"price-quote-number":{displayName:a["priceQuoteSchema.priceQuoteNumber"],type:"text"},"issue-date":{displayName:a["priceQuoteSchema.issueDate"],type:"datetime"},"expiration-date":{displayName:a["priceQuoteSchema.expirationDate"],type:"datetime"},"time-zone":{displayName:a["priceQuoteSchema.timeZone"],type:"text"},currency:{displayName:a["priceQuoteSchema.currency"],type:"text"},total:{displayName:a["priceQuoteSchema.total"],type:"number"},"customer-email":{displayName:a["priceQuoteSchema.customerEmail"],type:"text"},"customer-name":{displayName:a["priceQuoteSchema.customerName"],type:"text"},"customer-address-street":{displayName:a["priceQuoteSchema.customerAddressStreet"],type:"text"},"customer-address-city":{displayName:a["priceQuoteSchema.customerAddressCity"],type:"text"},"customer-address-zip":{displayName:a["priceQuoteSchema.customerAddressZip"],type:"text"},"customer-address-country":{displayName:a["priceQuoteSchema.customerAddressCountry"],type:"text"},"customer-address-description":{displayName:a["priceQuoteSchema.customerAddressDescription"],type:"text"},"business-name":{displayName:a["priceQuoteSchema.businessName"],type:"text"},"business-email":{displayName:a["priceQuoteSchema.businessEmail"],type:"text"},"preview-link":{displayName:a["priceQuoteSchema.previewLink"],type:"url"}},Array.from({length:10}).reduce(function(b,c,d){var e;return __assign({},b,(e={},e["item-"+(d+1)]={displayName:a["priceQuoteSchema.lineItem"]&&a["priceQuoteSchema.lineItem"].replace("{{index}}",d+1),type:"text"},e))},{}))]})})}},this.register(e),[2]}})})},b.prototype.registerInvoiceEvents=function(a){var b=a.accountLanguage,c=a.config.topology.smartActionsStaticsUrl;return __awaiter(this,void 0,void 0,function(){var a,d,e=this;return __generator(this,function(f){switch(f.label){case 0:return[4,h.get(c+"assets/locale/messages_"+b+".json")];case 1:return a=f.sent().data,d=["send","pay","future/overdue"].reduce(function(a,b){var c;return __assign((c={},c["invoice/"+b]={displayName:"grouped.event.invoice_"+b,displayDescription:"event.description.invoice_"+b,displayColor:"#EF73C0",removeSourceUniqueId:"future/overdue"!==b,supportsImmediateChat:!1,supportsPreEventTrigger:"future/overdue"===b},c),a)},{}),this.register({appDefId:BusinessManagerAPI.appDefIds.invoices,appTitle:a["appTitle.invoices"],events:d,generateEventSchema:function(b,c){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(b){return[2,__assign({},q({translations:a,contactFields:r}),{"invoice-number":{displayName:a["invoiceSchema.invoiceNumber"],type:"text"},"issue-date":{displayName:a["invoiceSchema.issueDate"],type:"datetime"},"due-date":{displayName:a["invoiceSchema.dueDate"],type:"datetime"},"time-zone":{displayName:a["invoiceSchema.timeZone"],type:"text"},currency:{displayName:a["invoiceSchema.currency"],type:"text"},total:{displayName:a["invoiceSchema.total"],type:"number"},balance:{displayName:a["invoiceSchema.balance"],type:"number"},"customer-email":{displayName:a["invoiceSchema.customerEmail"],type:"text"},"customer-name":{displayName:a["invoiceSchema.customerName"],type:"text"},"customer-address-street":{displayName:a["invoiceSchema.customerAddressStreet"],type:"text"},"customer-address-city":{displayName:a["invoiceSchema.customerAddressCity"],type:"text"},"customer-address-zip":{displayName:a["invoiceSchema.customerAddressZip"],type:"text"},"customer-address-country":{displayName:a["invoiceSchema.customerAddressCountry"],type:"text"},"customer-address-description":{displayName:a["invoiceSchema.customerAddressDescription"],type:"text"},"business-name":{displayName:a["invoiceSchema.businessName"],type:"text"},"business-email":{displayName:a["invoiceSchema.businessEmail"],type:"text"},"preview-link":{displayName:a["invoiceSchema.previewLink"],type:"url"}},Array.from({length:10}).reduce(function(b,c,d){var e;return __assign({},b,(e={},e["item-"+(d+1)]={displayName:a["invoiceSchema.lineItem"]&&a["invoiceSchema.lineItem"].replace("{{index}}",d+1),type:"text"},e))},{}))]})})}}),[2]}})})},b.prototype.registerSendMail=function(a){var b=a.accountLanguage,c=a.config.topology.sendMailStaticsUrl;return __awaiter(this,void 0,void 0,function(){var a,d,e,f,g,i=this;return __generator(this,function(j){switch(j.label){case 0:return[4,h.get(c+"assets/locale/messages_"+b+".json")];case 1:return a=j.sent().data,d="true"===this.experiments["specs.crm.AutomationsSpecificActionErrors"],e=function(a){return/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(a)},f=function(a){return a&&a.replace(/\s+/g,"").split(",").filter(function(a){return""!==a}).every(e)},g={appDefId:"b044bf47-a12d-4b6b-9e65-e384da03c745",actions:{"send-mail":{displayName:a.sendMailDisplayName,displayInfo:a.sendMailDisplayInfo,componentName:"send-mail-lazy-component",verifyConfig:function(b){var c=b.actionConfig;return __awaiter(i,void 0,void 0,function(){var b,e,g;return __generator(this,function(h){return b=JSON.parse(c),e=b.to,g=b.subject,e&&f(e)?g?[2,!0]:d?[2,Promise.reject(a["send-mail.error.missingSubject"])]:[2,!1]:d?[2,Promise.reject(a["send-mail.error.invalidEmail"])]:[2,!1]})})},generateConfig:function(a){var b=a.actionComponentInfo;return __awaiter(i,void 0,void 0,function(){return __generator(this,function(a){return[2,JSON.stringify(__assign({},b))]})})}}}},this.register(g),[2]}})})},b.prototype.registerZapierAction=function(a){var b=a.accountLanguage,c=a.config.topology.zapierActionStaticsUrl;return __awaiter(this,void 0,void 0,function(){var a,d,e,f,g,i,j=this;return __generator(this,function(k){switch(k.label){case 0:return a=ModuleRegistry.invoke("businessManager.isAppInstalled",BusinessManagerAPI.appDefIds.wixCode),d=ModuleRegistry.invoke("businessManager.isAppInstalled",BusinessManagerAPI.appDefIds.wixExpertsDashboard),e="true"===this.experiments["specs.crm.AutomationsShowZapierForPartners"],a||e&&d?[4,h.get(c+"assets/locale/messages_"+b+".json")]:[3,2];case 1:return g=k.sent(),[3,4];case 2:return[4,{data:{}}];case 3:g=k.sent(),k.label=4;case 4:return f=g.data,i={appDefId:"a3f3057f-1247-439f-bf12-e2148762e584",actions:{"forward-to-zapier":{displayName:f.zapierDisplayName,displayInfo:f.zapierDisplayInfo,componentName:"zapier-action-lazy-component",verifyConfig:function(){return __awaiter(j,void 0,void 0,function(){return __generator(this,function(a){return[2,!0]})})}}}},(a||e&&d)&&this.register(i),[2]}})})},b.prototype.registerEvents=function(a){var b=a.appDefId,c=a.events,d=__rest(a,["appDefId","events"]),e=this.eventRegistry[b]||{events:{}};this.eventRegistry[b]=__assign({events:__assign({},e.events,c)},d)},b.prototype.registerTriggers=function(a){var b=a.triggers;return __awaiter(this,void 0,void 0,function(){var a,c,d,e,f,g,i,j,k,l,m,n,o,p,q,r,s=this;return __generator(this,function(t){switch(t.label){case 0:a=this.moduleParams.accountLanguage,c=function(a){return a.schema&&a.schema.fields&&a.schema.fields.length},d=function(a){return a.schema.fields},e=function(a){return a.schema&&!!a.schema.dynamicSchemaUrl},f=function(a){return h.get(a.schema.dynamicSchemaUrl,{headers:{Authorization:BusinessManagerAPI.getCurrentInstance(BusinessManagerAPI.appDefIds.triggers)}})},g=function(b){return b.translationUrl.replace("{lang}",a)},i=function(a){var b=g(a);return s.translationsCache.has(b)?s.translationsCache.get(b):s.translationsCache.set(b,h.get(b)).get(b)},j=function(a){return __awaiter(s,void 0,void 0,function(){return __generator(this,function(b){return[2,c(a)?d(a):e(a)?f(a):[]]})})},k=function(a,b){return a.map(function(a){return __assign({},a,{displayName:b[a.displayName],description:b[a.description]})})},l=0,m=b,t.label=1;case 1:return l<m.length?(n=m[l],[4,Promise.all([i(n),j(n)])]):[3,4];case 2:o=t.sent(),p=o[0],q=o[1],r=k(q,p),this.eventRegistryV2.push(__assign({},n,{name:p[n.name],description:p[n.description],schema:{dynamicSchemaUrl:e(n)?n.schema.dynamicSchemaUrl:void 0,fields:r}})),t.label=3;case 3:return l++,[3,1];case 4:return[2]}})})},b.prototype.registerActionsV2=function(a){var b,c=a.actions;(b=this.actionRegistryV2).push.apply(b,c)},b.prototype.registerActions=function(a){var b=a.appDefId,c=a.actions,d=this.actionRegistry[b]||{actions:{}};this.actionRegistry[b]={actions:__assign({},d.actions,c)}},b.prototype.register=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,d,e,f,g,h,i;return __generator(this,function(j){switch(j.label){case 0:return[4,a];case 1:return b=j.sent(),c=b.appDefId,d=b.events,e=b.actions,f=b.triggers,g=b.isMigratedEvent,h=__rest(b,["appDefId","events","actions","triggers","isMigratedEvent"]),i=!g,d&&!i&&this.registerEvents(__assign({appDefId:c,events:d},h)),e&&(Array.isArray(e)?this.registerActionsV2({actions:e}):this.registerActions({appDefId:c,actions:e}),ModuleRegistry.notifyListeners("automations.actionRegistered")),f&&this.registerTriggers({triggers:f}),[2]}})})},b.prototype.config=function(a,b){this.register(b)},b}(BusinessManagerAPI.BusinessManagerModule);window.__IS_BUSINESS_MANAGER__=!0,d(c.Triggers,t)}(triggers||(triggers={}));